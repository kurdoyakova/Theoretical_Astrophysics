from matplotlib import pyplot as plt
from matplotlib.colors import LogNorm
from math import sqrt, log10, log, isnan
from scipy.optimize import curve_fit
import numpy as np
from scipy.ndimage.interpolation import rotate
from astropy.io import fits
from astropy.nddata import Cutout2D
from astropy.utils.data import download_file
from astropy.wcs import WCS
from matplotlib.widgets import RectangleSelector
from scipy import ndimage, misc

def func(x, c1, c2):
	# Линейная аппроксимация
    return c1*x + c2 

# r_e =  [2.3448147182600643, 2.098373024332479, 1.488793552294977, 2.0018829284189086, 1.7632658687144966, 1.554206218250162, 2.2976590524933287, 2.059065330228692, 1.9024141092826456]
# mu_e =  [28.881882489480688, 27.98611275766629, 27.008956926150795, 28.639864157627265, 29.039383469229136, 27.10640487264822, 29.303336339512043, 30.559602848586437, 29.06223653526363]

# r_e =  [0.8579661447820384, 0.21520061963881423, -0.3582148327658741, 0.2451473655409446, -0.08178774020183388, 0.9804055920506415, -0.431277043985303, 0.7635266644257749, 0.39787050310000494, 0.5126574482913537]
# mu_e =  [30.341219655703632, 27.795332219153508, 27.326110636893354, 29.26737898630322, 26.447550018284417, 33.57386759443068, 26.702050964038833, 30.737240578235088, 31.521819699477, 31.155878984438665]

r_e =  [0.8221203496194622, 0.4458411726539377, -0.3582148282383359, -0.10893040491829271, -0.19437331196031232, 0.3679583875000515, -0.11059448440085291, 0.6273696301727077, 0.3978705092545468, 0.5126574251799045]
mu_e =  [23.23677098693293, 21.927318000529638, 20.336410625685012, 20.393415689809245, 18.622911627252943, 24.51104738620009, 21.647935347825886, 23.06283594458654, 24.53211968388225, 24.166178842991823]
r =  np.linspace(-0.4, 1, 100)
mu_e2 = lambda x: 3* x+ 20.1
mu = np.vectorize(mu_e2)


fig, ax = plt.subplots()
popt, pcov = curve_fit(func, r_e, mu_e)
perr = np.sqrt(np.diag(pcov))   
ax.scatter(r_e, mu_e, label='Галлактики глубокого поля Хаббла', color='purple')
ax.plot(r_e, func(np.asarray(r_e), *popt), 'g--', label='fit: c1=%5.5f, c2=%5.5f' % tuple(popt))
# ax.set_ylim(max(mu_e)+0.5, min(mu_e)-0.5)
ax.set_xlabel(r'$\lg r_e$  [kpc]', fontsize=12)
ax.set_ylabel(r'$\mu_e$ ',fontsize=12)
plt.plot(r,mu(r), color='blue', label='Соотношение Кроменди')
plt.gca().invert_yaxis()
# print(r_e, mu_e2)
ax.legend()
plt.show()

print(perr)






# # r_e =  [0.7829652625550982, 0.4158875948453731, -0.3528228963666404, -0.042694126553638155, 0.605773159432454, 0.6201787384448059, 0.26786420446164827, 0.580443956138307, 0.151784354620728, 0.30647263188604185]
# # mu =  [30.063597533437914, 28.98147620578746, 27.363575938946646, 27.734403307324293, 30.40943896739261, 32.529273542203654, 30.882183817788224, 30.153771375921494, 30.525200480292675, 30.264765847394138]
# plt.scatter(r_e, mu)
# plt.gca().invert_yaxis()
# plt.show()